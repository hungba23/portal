(self.webpackChunkdevportal=self.webpackChunkdevportal||[]).push([[8780],{4137:function(e,t,n){"use strict";n.d(t,{Zo:function(){return c},kt:function(){return m}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(n),m=o,f=u["".concat(l,".").concat(m)]||u[m]||d[m]||a;return n?r.createElement(f,i(i({ref:t},c),{},{components:n})):r.createElement(f,i({ref:t},c))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var p=2;p<a;p++)i[p]=n[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},7901:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return s},metadata:function(){return l},toc:function(){return p},default:function(){return d}});var r=n(2122),o=n(9756),a=(n(7294),n(4137)),i={id:"kes_period",title:"KES Periods",sidebar_label:"KES periods",description:"Stake pool course: KES period assignment.",image:"./img/og-developer-portal.png"},s=void 0,l={unversionedId:"stake-pool-course/assignments/kes_period",id:"stake-pool-course/assignments/kes_period",isDocsHomePage:!1,title:"KES Periods",description:"Stake pool course: KES period assignment.",source:"@site/docs/stake-pool-course/assignments/kes_period.md",sourceDirName:"stake-pool-course/assignments",slug:"/stake-pool-course/assignments/kes_period",permalink:"/docs/stake-pool-course/assignments/kes_period",editUrl:"https://github.com/cardano-foundation/developer-portal/edit/staging/docs/stake-pool-course/assignments/kes_period.md",tags:[],version:"current",lastUpdatedBy:"katomm",lastUpdatedAt:1627034034,formattedLastUpdatedAt:"7/23/2021",frontMatter:{id:"kes_period",title:"KES Periods",sidebar_label:"KES periods",description:"Stake pool course: KES period assignment.",image:"./img/og-developer-portal.png"},sidebar:"someSidebar",previous:{title:"Assignment 2",permalink:"/docs/stake-pool-course/assignments/assignment-2"},next:{title:"Guild Operators Suite",permalink:"/docs/operate-a-stake-pool/guild-ops-suite"}},p=[],c={toc:p};function d(e){var t=e.components,n=(0,o.Z)(e,["components"]);return(0,a.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"To create an operational certificate for a block-producing node, you need to create a ",(0,a.kt)("em",{parentName:"p"},"KES key pair"),"."),(0,a.kt)("p",null,'Here "KES" stands for ',(0,a.kt)("em",{parentName:"p"},(0,a.kt)("strong",{parentName:"em"},"K"),"ey ",(0,a.kt)("strong",{parentName:"em"},"E"),"volving ",(0,a.kt)("strong",{parentName:"em"},"S"),"ignature"),", which means that after a certain ",(0,a.kt)("em",{parentName:"p"},"period"),", the key will ",(0,a.kt)("em",{parentName:"p"},"evolve")," to a new key and discard its old version. This is useful, because it means that even if an attacker compromises the key and gets access to the signing key, he can only use that to sign blocks ",(0,a.kt)("em",{parentName:"p"},"from now on"),", but not blocks dating from ",(0,a.kt)("em",{parentName:"p"},"earlier periods"),", making it impossible for the attacker to rewrite history."),(0,a.kt)("p",null,"Unfortunately, there is a catch: A KES key can only evolve for a certain number of periods and becomes useless afterwards. This means that before that number of periods has passed, the node operator has to generate a new KES key pair, issue a new operational node certificate with that new key pair and restart the node with the new certificate."),(0,a.kt)("p",null,"In order to find out how long one period is and for how long a key can evolve, we can look into the ",(0,a.kt)("em",{parentName:"p"},"genesis file"),". If that file is called ",(0,a.kt)("inlineCode",{parentName:"p"},"shelley_testnet-genesis.json"),", we can type"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'cat shelley_testnet-genesis.json | grep KES\n\n> "slotsPerKESPeriod": 3600,\n> "maxKESEvolutions": 120,\n')),(0,a.kt)("p",null,"and we see that in this example, the key will evolve after each period of 3600 slots and that it can evolve 120 times before it needs to be renewed."),(0,a.kt)("p",null,"Before we can create an operational certificate for our node, we need to figure out the start of the KES validity period, i.e. which KES evolution period we are in. We check the current slot ","(","assuming our relay node socket file is at ",(0,a.kt)("inlineCode",{parentName:"p"},"~/cardano-node/relay/db/node.socket"),")",":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'export CARDANO_NODE_SOCKET_PATH=~/cardano-node/relay/db/node.socket\ncardano-cli shelley query tip --testnet-magic 1097911063\n\n{\n    "blockNo": 27470,\n    "headerHash": "bd954e753c1131a6cb7ab3a737ca7f78e2477bea93db54511cedefe8899ebed0",\n    "slotNo": 656260\n}\n')),(0,a.kt)("p",null,"In this example, we are currently in slot 656260, and we know from the genesis file that one period lasts for 3600 slots. So we calculate the current period by"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"expr 656260 / 3600\n> 182\n")),(0,a.kt)("p",null,"With this we are able to generate an operational certificate for our stake pool (assuming the same file names as ",(0,a.kt)("a",{parentName:"p",href:"../handbook/generate-stake-pool-keys"},"here"),"):"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"cardano-cli shelley node issue-op-cert \\\n    --kes-verification-key-file kes.vkey \\\n    --cold-signing-key-file cold.skey \\\n    --operational-certificate-issue-counter cold.counter \\\n    --kes-period 182 \\\n    --out-file node.cert\n")))}d.isMDXComponent=!0}}]);