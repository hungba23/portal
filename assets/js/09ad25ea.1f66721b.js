(self.webpackChunkdevportal=self.webpackChunkdevportal||[]).push([[4732],{4137:function(e,t,a){"use strict";a.d(t,{Zo:function(){return d},kt:function(){return m}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var c=n.createContext({}),s=function(e){var t=n.useContext(c),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},d=function(e){var t=s(e.components);return n.createElement(c.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),u=s(a),m=r,h=u["".concat(c,".").concat(m)]||u[m]||p[m]||o;return a?n.createElement(h,i(i({ref:t},d),{},{components:a})):n.createElement(h,i({ref:t},d))}));function m(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=u;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var s=2;s<o;s++)i[s]=a[s];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},3137:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return i},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return s},default:function(){return p}});var n=a(2122),r=a(9756),o=(a(7294),a(4137)),i={id:"create-simple-transaction",title:"Create Simple Transaction",sidebar_label:"Create simple transaction",description:"Stake pool course: Learn how to create simple transaction.",image:"./img/og-developer-portal.png"},l=void 0,c={unversionedId:"stake-pool-course/handbook/create-simple-transaction",id:"stake-pool-course/handbook/create-simple-transaction",isDocsHomePage:!1,title:"Create Simple Transaction",description:"Stake pool course: Learn how to create simple transaction.",source:"@site/docs/stake-pool-course/handbook/create-simple-transaction.md",sourceDirName:"stake-pool-course/handbook",slug:"/stake-pool-course/handbook/create-simple-transaction",permalink:"/docs/stake-pool-course/handbook/create-simple-transaction",editUrl:"https://github.com/cardano-foundation/developer-portal/edit/staging/docs/stake-pool-course/handbook/create-simple-transaction.md",tags:[],version:"current",lastUpdatedBy:"Tommy",lastUpdatedAt:1632486943,formattedLastUpdatedAt:"9/24/2021",frontMatter:{id:"create-simple-transaction",title:"Create Simple Transaction",sidebar_label:"Create simple transaction",description:"Stake pool course: Learn how to create simple transaction.",image:"./img/og-developer-portal.png"},sidebar:"someSidebar",previous:{title:"Creating keys and addresses",permalink:"/docs/stake-pool-course/handbook/keys-addresses"},next:{title:"Create stake pool keys",permalink:"/docs/stake-pool-course/handbook/create-stake-pool-keys"}},s=[{value:"Get protocol parameters",id:"get-protocol-parameters",children:[]},{value:"Get the transaction hash and index of the <strong>UTXO</strong> to spend:",id:"get-the-transaction-hash-and-index-of-the-utxo-to-spend",children:[]},{value:"Draft the transaction",id:"draft-the-transaction",children:[]},{value:"Calculate the fee",id:"calculate-the-fee",children:[]},{value:"Calculate the change to send back to payment.addr",id:"calculate-the-change-to-send-back-to-paymentaddr",children:[]},{value:"Determine the TTL (time to Live) for the transaction",id:"determine-the-ttl-time-to-live-for-the-transaction",children:[]},{value:"Build the transaction",id:"build-the-transaction",children:[]},{value:"Sign the transaction",id:"sign-the-transaction",children:[]},{value:"Submit the transaction",id:"submit-the-transaction",children:[]},{value:"Check the balances",id:"check-the-balances",children:[]}],d={toc:s};function p(e){var t=e.components,a=(0,r.Z)(e,["components"]);return(0,o.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Creating a transaction requires various steps:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Get the protocol parameters"),(0,o.kt)("li",{parentName:"ul"},"Calculate the fee"),(0,o.kt)("li",{parentName:"ul"},"Define the time-to-live (TTL) for the transaction"),(0,o.kt)("li",{parentName:"ul"},"Build the transaction"),(0,o.kt)("li",{parentName:"ul"},"Sign the transaction"),(0,o.kt)("li",{parentName:"ul"},"Submit the transaction")),(0,o.kt)("h2",{id:"get-protocol-parameters"},"Get protocol parameters"),(0,o.kt)("p",null,"Get the protocol parameters and save them to ",(0,o.kt)("inlineCode",{parentName:"p"},"protocol.json")," with:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"cardano-cli query protocol-parameters \\\n  --mainnet \\\n  --out-file protocol.json\n")),(0,o.kt)("h2",{id:"get-the-transaction-hash-and-index-of-the-utxo-to-spend"},"Get the transaction hash and index of the ",(0,o.kt)("strong",{parentName:"h2"},"UTXO")," to spend:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"cardano-cli query utxo \\\n  --address $(cat payment.addr) \\\n  --mainnet\n")),(0,o.kt)("h2",{id:"draft-the-transaction"},"Draft the transaction"),(0,o.kt)("p",null,"Create a draft for the transaction and save it in tx.draft"),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"For ",(0,o.kt)("inlineCode",{parentName:"p"},"--tx-in")," we use the following syntax: ",(0,o.kt)("inlineCode",{parentName:"p"},"TxHash#TxIx")," where ",(0,o.kt)("inlineCode",{parentName:"p"},"TxHash")," is the transaction hash and ",(0,o.kt)("inlineCode",{parentName:"p"},"TxIx")," is the index; for ",(0,o.kt)("inlineCode",{parentName:"p"},"--tx-out")," we use: ",(0,o.kt)("inlineCode",{parentName:"p"},"TxOut+Lovelace")," where ",(0,o.kt)("inlineCode",{parentName:"p"},"TxOut")," is the hex encoded address followed by the amount in ",(0,o.kt)("inlineCode",{parentName:"p"},"Lovelace"),". For the transaction draft --tx-out, --invalid-hereafter and --fee can be set to zero."))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cardano-cli transaction build-raw \\\n--tx-in 4e3a6e7fdcb0d0efa17bf79c13aed2b4cb9baf37fb1aa2e39553d5bd720c5c99#4 \\\n--tx-out $(cat payment2.addr)+0 \\\n--tx-out $(cat payment.addr)+0 \\\n--invalid-hereafter 0 \\\n--fee 0 \\\n--out-file tx.draft\n")),(0,o.kt)("h2",{id:"calculate-the-fee"},"Calculate the fee"),(0,o.kt)("p",null,"A simple transaction needs one input, a valid UTXO from ",(0,o.kt)("inlineCode",{parentName:"p"},"payment.addr"),", and two outputs:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Output1: The address that receives the transaction."),(0,o.kt)("li",{parentName:"ul"},"Output2: The address that receives the change of the transaction.")),(0,o.kt)("p",null,"Note that to calculate the fee you need to include the draft transaction"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"    cardano-cli transaction calculate-min-fee \\\n    --tx-body-file tx.draft \\\n    --tx-in-count 1 \\\n    --tx-out-count 2 \\\n    --witness-count 1 \\\n    --byron-witness-count 0 \\\n    --mainnet \\\n    --protocol-params-file protocol.json\n")),(0,o.kt)("h2",{id:"calculate-the-change-to-send-back-to-paymentaddr"},"Calculate the change to send back to payment.addr"),(0,o.kt)("p",null,"all amounts must be in Lovelace:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"expr <UTXO BALANCE> - <AMOUNT TO SEND> - <TRANSACTION FEE>\n")),(0,o.kt)("p",null,"For example, if we send 10 ada from a UTxO containing 20 ada, the change to send back to ",(0,o.kt)("inlineCode",{parentName:"p"},"payment.addr")," after paying the fee is: 9.832035 ada"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"expr 20000000 - 10000000 - 167965\n9832035\n")),(0,o.kt)("h2",{id:"determine-the-ttl-time-to-live-for-the-transaction"},"Determine the TTL (time to Live) for the transaction"),(0,o.kt)("p",null,"To build the transaction we need to specify the ",(0,o.kt)("strong",{parentName:"p"},"TTL (Time to live)"),", this is the slot height limit for our transaction to be included in a block, if it is not in a block by that slot the transaction will be cancelled. So TTL = slot + N slots. Where N is the amount of slots you want to add to give the transaction a window to be included in a block."),(0,o.kt)("p",null,"Query the tip of the blockchain:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cardano-cli query tip --mainnet\n")),(0,o.kt)("p",null,"Look for the value of ",(0,o.kt)("inlineCode",{parentName:"p"},"slotNo")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'    {\n        "blockNo": 16829,\n        "headerHash": "3e6f59b10d605e7f59ba8383cb0ddcd42480ddcc0a85d41bad1e4648eb5465ad",\n        "slotNo": 369200\n    }\n')),(0,o.kt)("p",null,"Calculate your TTL, for example:  369200 + 200 slots = 369400"),(0,o.kt)("h2",{id:"build-the-transaction"},"Build the transaction"),(0,o.kt)("p",null,"We write the transaction in a file, we will name it ",(0,o.kt)("inlineCode",{parentName:"p"},"tx.raw"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"    cardano-cli transaction build-raw \\\n    --tx-in 4e3a6e7fdcb0d0efa17bf79c13aed2b4cb9baf37fb1aa2e39553d5bd720c5c99#4 \\\n    --tx-out $(cat payment2.addr)+10000000 \\\n    --tx-out $(cat payment.addr)+9832035 \\\n    --invalid-hereafter 369400 \\\n    --fee 167965 \\\n    --out-file tx.raw\n")),(0,o.kt)("h2",{id:"sign-the-transaction"},"Sign the transaction"),(0,o.kt)("p",null,"Sign the transaction with the signing key ",(0,o.kt)("strong",{parentName:"p"},"payment.skey")," and save the signed transaction in ",(0,o.kt)("strong",{parentName:"p"},"tx.signed")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"    cardano-cli transaction sign \\\n    --tx-body-file tx.raw \\\n    --signing-key-file payment.skey \\\n    --mainnet \\\n    --out-file tx.signed\n")),(0,o.kt)("h2",{id:"submit-the-transaction"},"Submit the transaction"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"    cardano-cli transaction submit \\\n    --tx-file tx.signed \\\n    --mainnet\n")),(0,o.kt)("h2",{id:"check-the-balances"},"Check the balances"),(0,o.kt)("p",null,"We must give it some time to get incorporated into the blockchain, but eventually, we will see the effect:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"cardano-cli query utxo \\\n--address $(cat payment.addr) \\\n--mainnet\n\n    >                            TxHash                                 TxIx         Amount\n    > ----------------------------------------------------------------------------------------\n    > b64ae44e1195b04663ab863b62337e626c65b0c9855a9fbb9ef4458f81a6f5ee     1         9832035 lovelace\n\ncardano-cli query utxo \\\n--address $(cat payment2.addr) \\\n--mainnet\n\n    >                            TxHash                                 TxIx         Amount\n    > ----------------------------------------------------------------------------------------\n    > b64ae44e1195b04663ab863b62337e626c65b0c9855a9fbb9ef4458f81a6f5ee     0         10000000 lovelace\n")),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},(0,o.kt)("inlineCode",{parentName:"p"},"--mainnet")," identifies the Cardano mainnet, for testnets use ",(0,o.kt)("inlineCode",{parentName:"p"},"--testnet-magic 1097911063")," instead."))))}p.isMDXComponent=!0}}]);